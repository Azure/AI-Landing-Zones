## Reliability

| ID    | Specification |
|-------|--------------|
|  R-R1  | **Multi-region disaster recovery:** Provide endpoints in at least two regions for redundancy and availability.<br><br><strong>Best practice:</strong><br>Establish BC/DR policy for endpoints and data. Configure baseline DR for [Azure AI Foundry](https://learn.microsoft.com/azure/ai-studio/how-to/disaster-recovery), [Azure Machine Learning](https://learn.microsoft.com/azure/machine-learning/how-to-high-availability-machine-learning), [Azure OpenAI](https://learn.microsoft.com/azure/ai-services/openai/how-to/business-continuity-disaster-recovery), and supporting data stores ([Azure Blob Storage](https://learn.microsoft.com/azure/storage/common/storage-disaster-recovery-guidance), [Azure Cosmos DB](https://learn.microsoft.com/azure/cosmos-db/online-backup-and-restore), [Azure SQL Database](https://learn.microsoft.com/azure/azure-sql/accelerated-database-recovery)). Validate failover (DNS / Azure Traffic Manager / Azure Front Door) quarterly.|
|  R-R2  | **APRL alignment:** Align with service/workload recommendations from APRL [Artificial Intelligence (GPT-RAG)](https://azure.github.io/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/ai/) and [Azure resources](https://azure.github.io/Azure-Proactive-Resiliency-Library-v2/azure-resources/).<br><br><strong>Best practice:</strong><br>Treat APRL items as a resiliency backlog; track remediation and review quarterly.|
|  R-R3  | **Traffic management & regional failover:** Use Front Door (or Traffic Manager) in front of APIM + Application Gateway to route traffic to healthy regional endpoints.<br><br><strong>Best practice:</strong><br>Probe APIM plus synthetic prompt flow. Document RTO/RPO and run game days quarterly.|
|  R-R4  | **Model fallback & graceful degradation:** Implement primary → secondary (region/SKU) → distilled model or cached response chain.<br><br><strong>Best practice:</strong><br>Return partial summarised answer (with limitation note) instead of generic 5xx on quota/capacity pressure.|
|  R-R5  | **Quota, throttling & retries:** Detect 429/503 and throughput throttles; apply exponential backoff with jitter.<br><br><strong>Best practice:</strong><br>Log `quotaCategory`, `retryCount`; alert on sustained throttle >5% over 10 minutes.|
|  R-R6  | **Circuit breakers & timeouts:** Wrap external calls with timeouts lower than upstream gateway; add circuit breakers on failure/latency thresholds.<br><br><strong>Best practice:</strong><br>Serve last-good / cached response while half‑open probing.|
|  R-R7  | **Bulkhead & isolation:** Place experimental/high-risk agents in separate workload profiles and queues.<br><br><strong>Best practice:</strong><br>Enforce concurrency limits; isolate egress when firewall policies differ.|
|  R-R8  | **State & vector index resilience:** Partition Cosmos containers; shard vector/hybrid indexes for horizontal rebuild.<br><br><strong>Best practice:</strong><br>Automate export + reindex and record MTTR objective; test recreation twice yearly.|
|  R-R9  | **Data durability & backup:** Enable ZRS/GRS for prompt assets and embeddings; validate recovery flows.<br><br><strong>Best practice:</strong><br>Test PITR (Cosmos) and index rebuild regularly; track success rate.|
|  R-R10 | **Safe deployment & rollback:** Stage rollout of prompts, model versions, APIM policies, WAF rules.<br><br><strong>Best practice:</strong><br>Snapshot parameters each release to enable rollback on SLO breach.|
|  R-R11 | **Chaos & failure injection:** Inject latency/faults (model timeout, search failure, regional loss) in non‑prod.<br><br><strong>Best practice:</strong><br>Measure failover duration and error budget impact; feed backlog.|
|  R-R12 | **Observability & SLOs:** Define SLOs (p95 latency, success %, vector retrieval latency).<br><br><strong>Best practice:</strong><br>Correlate traces end-to-end; alert on burn rate (e.g., 14‑day budget consumed in 6h).|
|  R-R13 | **Dependency classification:** Maintain tier registry (Tier 0 critical, Tier 1 supporting, Tier 2 ancillary).<br><br><strong>Best practice:</strong><br>Apply tighter timeouts/fallback for Tier 0; review quarterly.|
|  R-R14 | **Configuration drift & compliance:** Monitor drift for parameters impacting resilience.<br><br><strong>Best practice:</strong><br>Automate nightly what‑if / plan; remediate within MTTR target (e.g., 24h).|
|  R-R15 | **Capacity & autoscale validation:** Load test token throughput, concurrent sessions, vector QPS.<br><br><strong>Best practice:</strong><br>Validate N+1 regional failure meets p95 latency; tune min/max replicas & capacity units.|
|  R-R16 | **Backpressure & queueing:** Enforce bounded queues for ingestion / enrichment flows.<br><br><strong>Best practice:</strong><br>Defer non‑critical work when latency degrades; emit queue depth metrics.|
|  R-R17 | **Secret & key rotation reliability:** Use versioned secrets & managed identities; pre‑rotate residual keys.<br><br><strong>Best practice:</strong><br>Alert on stale secret usage >24h post-rotation; validate auth before revocation.|
|  R-R18 | **Telemetry integrity:** Configure diagnostic settings with sampling; avoid blocking pipeline on telemetry failures.<br><br><strong>Best practice:</strong><br>Prefer business KPIs over verbose debug; implement short‑lived buffering fallback.|
|  R-R19 | **WAF & security policy change safety:** Stage WAF rule updates in Detection with synthetic replay.<br><br><strong>Best practice:</strong><br>Promote to Prevention only when false positives below threshold.|
|  R-R20 | **Graceful shutdown & draining:** Enable connection draining and revision traffic shifting.<br><br><strong>Best practice:</strong><br>Pause scale‑in during drain to prevent request loss.|
|  R-R21 | **Platform resource limits monitoring:** Track approaching limits (Search partitions, Cosmos RU, APIM units, concurrency).<br><br><strong>Best practice:</strong><br>Alert at 80% sustained 15m; scale or re‑shard before saturation.|
|  R-R22 | **Time synchronization & clock skew:** Enforce time sync across VMs; validate token expiry tolerance.<br><br><strong>Best practice:</strong><br>Run synthetic skew tests; rotate tokens early if skew >60s.|
|  R-R23 | **Schema & prompt change compatibility:** Version prompts; canary against shadow index / staging container.<br><br><strong>Best practice:</strong><br>Block promotion if retrieval + grounding regression detected.|
|  R-R24 | **Regional data residency constraints:** Tag data assets with residency classification; respect restrictions during failover.<br><br><strong>Best practice:</strong><br>Degrade features needing restricted data rather than violating controls.|
|  R-R25 | **Incident runbooks & communication:** Maintain runbooks for key failure modes (capacity, index corruption, routing failure, regional outage).<br><br><strong>Best practice:</strong><br>Include escalation matrix, decision timers, rollback steps.|
