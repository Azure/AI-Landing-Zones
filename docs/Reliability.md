## Reliability

| ID    | Specification |
|-------|--------------|
|  R-R1  | **Multi-Region Disaster Recovery**: The AI Landing Zone should provide AI endpoints in at least two regions to provide redundancy and ensure high availability.<br><br>Best Practice:<br><br> Establish a policy for business continuity and disaster recovery for your AI endpoints and AI data. Configure baseline disaster recovery for resources that host your AI model endpoints. These resources include [Azure AI Foundry](https://learn.microsoft.com/azure/ai-studio/how-to/disaster-recovery), [Azure Machine Learning](https://learn.microsoft.com/azure/machine-learning/how-to-high-availability-machine-learning), [Azure OpenAI](https://learn.microsoft.com/azure/ai-services/openai/how-to/business-continuity-disaster-recovery), or Azure AI services. All Azure data stores, such as [Azure Blob Storage](https://learn.microsoft.com/azure/storage/common/storage-disaster-recovery-guidance), [Azure Cosmos DB](https://learn.microsoft.com/azure/cosmos-db/online-backup-and-restore), and [Azure SQL Database](https://learn.microsoft.com/azure/azure-sql/accelerated-database-recovery), provide reliability and disaster recovery guidance that you should follow. Implement multi-region deployments to ensure high availability and resiliency for both generative and non-generative AI systems. For more information, see multi-region deployment in [Azure AI Foundry](https://learn.microsoft.com/azure/ai-studio/how-to/disaster-recovery#plan-for-multi-regional-deployment), [Azure Machine Learning](https://learn.microsoft.com/azure/machine-learning/how-to-high-availability-machine-learning#plan-for-multi-regional-deployment), and [Azure OpenAI](https://learn.microsoft.com/azure/ai-services/openai/how-to/business-continuity-disaster-recovery).|
|  R-R2  | **APRL:** The AI Landing Zone should align with the service and workload level recommendations from APRL [Artificial Intelligence (GPT-RAG)](https://azure.github.io/Azure-Proactive-Resiliency-Library-v2/azure-specialized-workloads/ai/) and [Azure Resources.](https://azure.github.io/Azure-Proactive-Resiliency-Library-v2/azure-resources/)|
|  R-R3  | **Traffic Management & Regional Failover:** Use Azure Front Door (or Traffic Manager) in front of APIM + Application Gateway to route traffic to healthy regional AI Foundry / model endpoints. Implement health probes for APIM gateway and synthetic prompt tests. Document RTO/RPO and validate failover quarterly. |
|  R-R4  | **Model Fallback & Graceful Degradation:** In orchestration Container Apps, implement policy chain: primary Azure OpenAI deployment → alternate region / SKU → distilled model or cached response. Return partial / summarised answer instead of HTTP 5xx when capacity or quota constrained. |
|  R-R5  | **Quota, Throttling & Retries:** Detect Azure OpenAI (429 / 503) and Search/Cosmos throughput throttles. Apply exponential backoff with full jitter. Log structured events (quotaCategory, retryCount) to Application Insights. Alert on sustained throttle >5% over 10 min. |
|  R-R6  | **Circuit Breakers & Timeouts:** Wrap calls to model endpoints, AI Search, Cosmos DB vector operations with client timeouts (< upstream APIM timeout) and circuit breakers (failure rate + slow call thresholds). Serve cached embeddings / last-good response while probing for recovery. |
|  R-R7  | **Bulkhead & Isolation:** Allocate experimental or high-risk agents to separate Container Apps workload profiles and dedicated queues; enforce per-profile concurrency limits to prevent starvation of production agents. Isolate egress via distinct subnets if firewall rules differ. |
|  R-R8  | **State & Vector Index Resilience:** Partition Cosmos DB containers by session or tenant; design AI Search indexes (or alternative vector store) for horizontal rebuild (sharded by collection). Maintain automated export + reindex workflow (GitOps manifest) and document MTTR objective. |
|  R-R9  | **Data Durability & Backup:** Enable zone-redundant storage (ZRS) or GRS for prompt assets and embeddings (Storage Account). Validate point-in-time restore for Cosmos DB and index recreation procedure for AI Search twice yearly. Track success in reliability scorecard. |
|  R-R10 | **Safe Deployment & Rollback:** Use staged rollout for: prompt templates, model version changes (AI Foundry), APIM policies, App Gateway/WAF rules. Maintain parameter snapshot (IaC variables + prompt catalog) enabling one-click rollback on SLO breach. |
|  R-R11 | **Chaos & Failure Injection:** Inject synthetic latency / faults into non-prod APIM policies or via feature flag in orchestration layer to simulate model timeouts, Search failures, and partial regional loss. Measure auto-failover time and error budget consumption. |
|  R-R12 | **Observability & SLOs:** Define SLOs: p95 end-to-end latency (ingress → first token), success rate, vector retrieval latency. Correlate traces across APIM, App Gateway, Container Apps, model calls (OpenTelemetry). Trigger alerts when burn rate exceeds defined thresholds (e.g., 14d budget burned in 6h). |
|  R-R13 | **Dependency Classification:** Maintain registry: Tier 0 (Model endpoint, Cosmos DB vector store), Tier 1 (AI Search, Key Vault), Tier 2 (Analytics pipelines). Apply stricter timeouts + fallback for Tier 0, relaxed retry strategies for Tier 2. Review quarterly. |
|  R-R14 | **Configuration Drift & Compliance:** Monitor IaC drift for reliability parameters: `publicNetworkAccessEnabled`, zone redundancy flags, APIM capacity units, Search replica/partition counts, autoscale minReplicas. Remediate drift within MTTR target (e.g., 24h). |
|  R-R15 | **Capacity & Autoscale Validation:** Performance test token throughput, concurrent chat sessions, and vector query QPS. Tune: Container Apps min/max replicas, APIM units, Search replicas, Cosmos RU autoscale limits, model deployment capacity. Validate N+1 region failure still meets p95 latency SLO. |
|  R-R16 | **Backpressure & Queueing:** For ingestion / enrichment flows (document chunking, embedding generation), enforce bounded queues (e.g., Storage + queue trigger or Service Bus). Drop or defer non-critical enrichment jobs when interactive inference latency degrades. |
|  R-R17 | **Secret & Key Rotation Reliability:** Use Key Vault versioned secrets and managed identity. Pre-rotate model or Search keys (if any residual usage) with health probes validating successful auth before revoking old versions. Automate alert on stale secret usage >24h post-rotation. |
|  R-R18 | **Telemetry Integrity:** Configure diagnostic settings for APIM, Container Apps, AI Foundry, Cosmos, Search to Log Analytics with sampling for high-volume traces. Implement fallback local buffering (short-lived) without blocking request pipeline. Prioritize business metrics over verbose debug logs under pressure. |
|  R-R19 | **WAF & Security Policy Change Safety:** Stage WAF rule set updates (OWASP version bumps, exclusion changes) in Detection mode with synthetic traffic replay (captured APIM logs). Promote to Prevention only when false-positive threshold < agreed target. |
|  R-R20 | **Graceful Shutdown & Draining:** Enable connection draining on Application Gateway listeners; configure Container Apps revision traffic shifting (0→100) rather than hard switch. Pause autoscale scale-in during drain to avoid request loss. |
|  R-R21 | **Platform Resource Limits Monitoring:** Track nearing limits: Search partitions/replicas, Cosmos RU % consumption, APIM capacity % utilization, Container Apps concurrent connections, Key Vault throttles. Alert at 80% sustained for 15m; plan scale or re-shard. |
|  R-R22 | **Time Synchronization & Clock Skew:** Enforce time sync baseline across VMs (Build/Jump) and Container Apps (platform managed). Validate token expiry (JWT, SAS) tolerance by synthetic skew tests; rotate tokens early if skew >60s detected. |
|  R-R23 | **Schema & Prompt Change Compatibility:** Version prompt templates with semantic tags; canary deploy against a shadow index (AI Search) or staging Cosmos container. Confirm retrieval + grounding chain integrity before production promotion. |
|  R-R24 | **Regional Data Residency Constraints:** Tag data assets (Cosmos containers, Storage containers, indexes) with residency classification. During failover, route only allowable traffic cross-region; degrade features requiring restricted data instead of violating policy. |
|  R-R25 | **Incident Runbooks & Communication:** Provide runbooks: model capacity exhaustion, vector index corruption, Search latency spike, APIM routing failure, regional outage. Include escalation matrix, decision timers, and rollback steps referencing IaC parameter sets. |
