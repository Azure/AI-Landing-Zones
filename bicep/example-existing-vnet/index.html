
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Azure AI Landing Zones">
      
      
        <meta name="author" content="Microsoft">
      
      
      
        <link rel="prev" href="../example-platform/">
      
      
        <link rel="next" href="../../terraform/">
      
      
        
      
      
      <link rel="icon" href="../../media/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>With Existing VNet - Azure AI Landing Zones</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ai-lz-using-an-existing-vnet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Azure AI Landing Zones" class="md-header__button md-logo" aria-label="Azure AI Landing Zones" data-md-component="logo">
      
  <img src="../../media/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azure AI Landing Zones
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              With Existing VNet
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Azure/AI-Landing-Zones" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Azure AI Landing Zones" class="md-nav__button md-logo" aria-label="Azure AI Landing Zones" data-md-component="logo">
      
  <img src="../../media/logo.svg" alt="logo">

    </a>
    Azure AI Landing Zones
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Azure/AI-Landing-Zones" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../whatisnew/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What's New
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/design-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Checklist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/cost-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cost Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Bicep Implementation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Bicep Implementation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts-networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Platform LZ Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to use
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parameterization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parameterization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" checked>
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example-standalone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Standalone
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Platform LZ Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    With Existing VNet
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../terraform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terraform Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../portal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Portal installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="ai-lz-using-an-existing-vnet">AI LZ using an existing VNet</h1>
<p>This walkthrough validates deploying the AI Landing Zone into a VNet that already exists. It is intended for learning and validation, and it follows the same expectations described in the networking and platform guidance.</p>
<p><strong>Sample parameter files</strong></p>
<table>
<thead>
<tr>
<th>File</th>
<th>Scenario</th>
<th>What happens to the VNet and subnets</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/Azure/AI-Landing-Zones/blob/main/bicep/infra/sample.existing-vnet.bicepparam">bicep/infra/sample.existing-vnet.bicepparam</a></td>
<td>Scenario A</td>
<td>Reuses an existing VNet and expects the required subnets to already exist.</td>
</tr>
<tr>
<td><a href="https://github.com/Azure/AI-Landing-Zones/blob/main/bicep/infra/sample.existing-vnet-create-subnets.bicepparam">bicep/infra/sample.existing-vnet-create-subnets.bicepparam</a></td>
<td>Scenario B</td>
<td>Reuses an existing VNet and creates or updates the required subnets in that VNet.</td>
</tr>
</tbody>
</table>
<p><strong>What this walkthrough validates</strong></p>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Existing VNet reuse</td>
<td>Uses <code>resourceIds.virtualNetworkResourceId</code> and does not create a new VNet.</td>
</tr>
<tr>
<td>Workload-owned private connectivity</td>
<td>Creates Private Endpoints and, in this scenario, also creates Private DNS zones and VNet links.</td>
</tr>
<tr>
<td>Forced tunneling validation</td>
<td>When enabled by toggles, deploys UDRs and routes egress through Azure Firewall.</td>
</tr>
<tr>
<td>Split resource groups</td>
<td>Keeps the VNet in a dedicated networking resource group and deploys workload resources to a separate workload resource group.</td>
</tr>
</tbody>
</table>
<p>This walkthrough assumes standalone behavior for platform integration, with <code>flagPlatformLandingZone</code> set to <code>false</code>.</p>
<p><strong>Key settings (from the samples)</strong></p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>flagPlatformLandingZone</code></td>
<td><code>false</code></td>
<td>The workload deployment owns private DNS zones and links for this walkthrough.</td>
</tr>
<tr>
<td><code>deployToggles.virtualNetwork</code></td>
<td><code>false</code></td>
<td>The deployment reuses an existing VNet.</td>
</tr>
<tr>
<td><code>resourceIds.virtualNetworkResourceId</code></td>
<td>Required</td>
<td>Must be the full resource ID of the existing VNet.</td>
</tr>
<tr>
<td><code>existingVNetSubnetsDefinition</code></td>
<td>Optional</td>
<td>Use only for Scenario B, when the deployment should create or update subnets.</td>
</tr>
</tbody>
</table>
<p><strong>Scope and assumptions</strong></p>
<p>The existing VNet must be in the same subscription used by the environment. Resources that attach to subnets, such as Private Endpoints, NICs, Bastion, and route table associations, must be deployed in the same subscription as the VNet.</p>
<p><strong>Prerequisites</strong></p>
<p>You need permissions to create resources in the target subscription, and you must be signed in with Azure CLI. This walkthrough uses Azure Developer CLI, so install <code>azd</code> and run the commands from the repository root.</p>
<p><strong>Step 1: Prepare the existing VNet</strong></p>
<p>Use one of the scenarios below. Both scenarios use the same default VNet address space and subnet layout.</p>
<p>Scenario A expects the required subnets to already exist. Scenario B creates or updates the subnets as part of the deployment.</p>
<p><strong>Default addressing used by the samples</strong></p>
<p>VNet address space is <code>192.168.0.0/23</code>.</p>
<table>
<thead>
<tr>
<th>Subnet name</th>
<th>CIDR</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent-subnet</code></td>
<td><code>192.168.0.0/27</code></td>
<td>Delegated to <code>Microsoft.App/environments</code>.</td>
</tr>
<tr>
<td><code>pe-subnet</code></td>
<td><code>192.168.0.32/27</code></td>
<td>Private endpoint network policies must be disabled.</td>
</tr>
<tr>
<td><code>AzureBastionSubnet</code></td>
<td><code>192.168.0.64/26</code></td>
<td>Required minimum size for Bastion.</td>
</tr>
<tr>
<td><code>AzureFirewallSubnet</code></td>
<td><code>192.168.0.128/26</code></td>
<td>Required minimum size for Azure Firewall.</td>
</tr>
<tr>
<td><code>appgw-subnet</code></td>
<td><code>192.168.0.192/27</code></td>
<td>Optional depending on toggles.</td>
</tr>
<tr>
<td><code>apim-subnet</code></td>
<td><code>192.168.0.224/27</code></td>
<td>Optional depending on toggles.</td>
</tr>
<tr>
<td><code>aca-env-subnet</code></td>
<td><code>192.168.1.0/27</code></td>
<td>Delegated to <code>Microsoft.App/environments</code>.</td>
</tr>
<tr>
<td><code>devops-agents-subnet</code></td>
<td><code>192.168.1.32/27</code></td>
<td>Build agents subnet.</td>
</tr>
<tr>
<td><code>jumpbox-subnet</code></td>
<td><code>192.168.1.64/28</code></td>
<td>Jump VM subnet.</td>
</tr>
</tbody>
</table>
<p><strong>Scenario A: create the VNet and subnets up front</strong></p>
<p>Choose a location and names that you will reuse across commands.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$location</span> <span class="p">=</span> <span class="s2">&quot;eastus2&quot;</span>
<span class="nv">$netRg</span> <span class="p">=</span> <span class="s2">&quot;rg-ailz-vnet-RANDOM_SUFFIX&quot;</span>
<span class="nv">$vnetName</span> <span class="p">=</span> <span class="s2">&quot;vnet-existing-RANDOM_SUFFIX&quot;</span>
</code></pre></div>
<p>Create the networking resource group and VNet.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="nb">group </span><span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-location</span> <span class="nv">$location</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">23</span>
</code></pre></div>
<p>Create the required subnets.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">agent-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">27</span> <span class="p">-</span><span class="n">-delegations</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">App</span><span class="p">/</span><span class="n">environments</span>

<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">pe-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">32</span><span class="p">/</span><span class="n">27</span> <span class="p">-</span><span class="n">-disable-private-endpoint-network-policies</span> <span class="n">true</span>

<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">AzureBastionSubnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">64</span><span class="p">/</span><span class="n">26</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">AzureFirewallSubnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">128</span><span class="p">/</span><span class="n">26</span>

<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">appgw-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">192</span><span class="p">/</span><span class="n">27</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">apim-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">224</span><span class="p">/</span><span class="n">27</span>

<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">aca-env-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">27</span> <span class="p">-</span><span class="n">-delegations</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">App</span><span class="p">/</span><span class="n">environments</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">devops-agents-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">32</span><span class="p">/</span><span class="n">27</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">jumpbox-subnet</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">64</span><span class="p">/</span><span class="n">28</span>
</code></pre></div>
<p>Verify subnets and capture the VNet resource ID.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="n">-o</span> <span class="n">table</span>

<span class="nv">$vnetId</span> <span class="p">=</span> <span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">show</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-query</span> <span class="n">id</span> <span class="n">-o</span> <span class="n">tsv</span>
<span class="nv">$vnetId</span>
</code></pre></div>
<p><strong>Scenario B: create only the VNet and let the template create or update subnets</strong></p>
<p>Create the networking resource group and VNet.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$location</span> <span class="p">=</span> <span class="s2">&quot;eastus2&quot;</span>
<span class="nv">$netRg</span> <span class="p">=</span> <span class="s2">&quot;rg-ailz-vnet-RANDOM_SUFFIX&quot;</span>
<span class="nv">$vnetName</span> <span class="p">=</span> <span class="s2">&quot;vnet-existing-RANDOM_SUFFIX&quot;</span>

<span class="n">az</span> <span class="nb">group </span><span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-location</span> <span class="nv">$location</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-address-prefixes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">23</span>

<span class="nv">$vnetId</span> <span class="p">=</span> <span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">show</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-query</span> <span class="n">id</span> <span class="n">-o</span> <span class="n">tsv</span>
<span class="nv">$vnetId</span>
</code></pre></div>
<p>If you already have a VNet that matches the expected layout, skip the creation commands and only capture the VNet resource ID.</p>
<p><strong>Step 2: Deploy the workload with azd</strong></p>
<p>Initialize an azd environment.</p>
<div class="highlight"><pre><span></span><code><span class="n">azd</span> <span class="n">init</span> <span class="n">-e</span> <span class="n">ailz-existing-vnet-RANDOM_SUFFIX</span>
</code></pre></div>
<p>Set environment variables.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$env:AZURE_LOCATION</span> <span class="p">=</span> <span class="s2">&quot;eastus2&quot;</span>
<span class="nv">$env:AZURE_RESOURCE_GROUP</span> <span class="p">=</span> <span class="s2">&quot;rg-ailz-RANDOM_SUFFIX&quot;</span>
<span class="nv">$env:AZURE_SUBSCRIPTION_ID</span> <span class="p">=</span> <span class="s2">&quot;00000000-1111-2222-3333-444444444444&quot;</span>

<span class="nv">$workloadRg</span> <span class="p">=</span> <span class="nv">$env:AZURE_RESOURCE_GROUP</span>
</code></pre></div>
<p>Copy the sample parameter file into the active parameter file used by <code>azd</code>.</p>
<p>Scenario A uses the reuse-as-is sample.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Copy-Item</span> <span class="n">bicep</span><span class="p">/</span><span class="n">infra</span><span class="p">/</span><span class="n">sample</span><span class="p">.</span><span class="n">existing-vnet</span><span class="p">.</span><span class="n">bicepparam</span> <span class="n">bicep</span><span class="p">/</span><span class="n">infra</span><span class="p">/</span><span class="n">main</span><span class="p">.</span><span class="n">bicepparam</span> <span class="n">-Force</span>
</code></pre></div>
<p>Scenario B uses the create-update-subnets sample.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Copy-Item</span> <span class="n">bicep</span><span class="p">/</span><span class="n">infra</span><span class="p">/</span><span class="n">sample</span><span class="p">.</span><span class="n">existing-vnet-create-subnets</span><span class="p">.</span><span class="n">bicepparam</span> <span class="n">bicep</span><span class="p">/</span><span class="n">infra</span><span class="p">/</span><span class="n">main</span><span class="p">.</span><span class="n">bicepparam</span> <span class="n">-Force</span>
</code></pre></div>
<p>Edit <code>bicep/infra/main.bicepparam</code> and set <code>resourceIds.virtualNetworkResourceId</code> to <code>$vnetId</code>.</p>
<p>For Scenario A, do not set <code>existingVNetSubnetsDefinition</code>.</p>
<p>For Scenario B, provide an <code>existingVNetSubnetsDefinition</code> block with the subnet layout you want the deployment to create or update.</p>
<div class="highlight"><pre><span></span><code>param existingVNetSubnetsDefinition = {
  useDefaultSubnets: false
  subnets: [
    {
      name: &#39;agent-subnet&#39;
      addressPrefix: &#39;192.168.0.0/27&#39;
      delegation: &#39;Microsoft.App/environments&#39;
      serviceEndpoints: [&#39;Microsoft.CognitiveServices&#39;]
    }
    {
      name: &#39;pe-subnet&#39;
      addressPrefix: &#39;192.168.0.32/27&#39;
      privateEndpointNetworkPolicies: &#39;Disabled&#39;
      serviceEndpoints: [&#39;Microsoft.AzureCosmosDB&#39;]
    }
    {
      name: &#39;AzureBastionSubnet&#39;
      addressPrefix: &#39;192.168.0.64/26&#39;
    }
    {
      name: &#39;AzureFirewallSubnet&#39;
      addressPrefix: &#39;192.168.0.128/26&#39;
    }
    {
      name: &#39;appgw-subnet&#39;
      addressPrefix: &#39;192.168.0.192/27&#39;
    }
    {
      name: &#39;apim-subnet&#39;
      addressPrefix: &#39;192.168.0.224/27&#39;
    }
    {
      name: &#39;aca-env-subnet&#39;
      addressPrefix: &#39;192.168.1.0/27&#39;
      delegation: &#39;Microsoft.App/environments&#39;
      serviceEndpoints: [&#39;Microsoft.AzureCosmosDB&#39;]
    }
    {
      name: &#39;devops-agents-subnet&#39;
      addressPrefix: &#39;192.168.1.32/27&#39;
    }
    {
      name: &#39;jumpbox-subnet&#39;
      addressPrefix: &#39;192.168.1.64/28&#39;
    }
  ]
}
</code></pre></div>
<p>Provision.</p>
<div class="highlight"><pre><span></span><code><span class="n">azd</span> <span class="n">provision</span>
</code></pre></div>
<p>If forced tunneling is enabled, ensure <code>firewallPrivateIp</code> matches the private IP assigned to Azure Firewall. With the default <code>AzureFirewallSubnet</code> prefix, the common value is <code>192.168.0.132</code>, but you should always confirm the actual IP in your environment.</p>
<p><strong>Validation</strong></p>
<p>Validate that private endpoints were created in the workload resource group.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$workloadRg</span> <span class="n">-o</span> <span class="n">table</span>
</code></pre></div>
<p>Because this walkthrough uses <code>flagPlatformLandingZone</code> set to <code>false</code>, validate that private DNS zones exist and are linked.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="n">network</span> <span class="n">private-dns</span> <span class="n">zone</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$workloadRg</span> <span class="n">-o</span> <span class="n">table</span>

<span class="n">az</span> <span class="n">network</span> <span class="n">private-dns</span> <span class="n">link</span> <span class="n">vnet</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$workloadRg</span> <span class="p">-</span><span class="n">-zone-name</span> <span class="n">privatelink</span><span class="p">.</span><span class="n">openai</span><span class="p">.</span><span class="n">azure</span><span class="p">.</span><span class="n">com</span> <span class="n">-o</span> <span class="n">table</span>
</code></pre></div>
<p>Validate that A records exist.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="n">network</span> <span class="n">private-dns</span> <span class="n">record-set</span> <span class="n">a</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$workloadRg</span> <span class="p">-</span><span class="n">-zone-name</span> <span class="n">privatelink</span><span class="p">.</span><span class="n">openai</span><span class="p">.</span><span class="n">azure</span><span class="p">.</span><span class="n">com</span> <span class="n">-o</span> <span class="n">table</span>
</code></pre></div>
<p>If forced tunneling is enabled, validate that route tables exist and are associated with the expected subnets.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="n">network</span> <span class="n">route-table</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$workloadRg</span> <span class="n">-o</span> <span class="n">table</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">vnet</span> <span class="n">subnet</span> <span class="n">show</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-vnet-name</span> <span class="nv">$vnetName</span> <span class="p">-</span><span class="n">-name</span> <span class="n">jumpbox-subnet</span> <span class="p">-</span><span class="n">-query</span> <span class="n">routeTable</span><span class="p">.</span><span class="n">id</span> <span class="n">-o</span> <span class="n">tsv</span>
</code></pre></div>
<p>Validate access through Bastion and the Jump VM.</p>
<p>Reset the Jump VM password in the Azure portal and connect using Bastion. Then, from inside the Jump VM, validate DNS resolution for your created services.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Resolve-DnsName</span> <span class="n">login</span><span class="p">.</span><span class="n">microsoftonline</span><span class="p">.</span><span class="n">com</span>
<span class="nb">Test-NetConnection</span> <span class="n">login</span><span class="p">.</span><span class="n">microsoftonline</span><span class="p">.</span><span class="n">com</span> <span class="n">-Port</span> <span class="n">443</span>
</code></pre></div>
<p>To validate private DNS resolution for specific Private Endpoints, list the FQDNs associated with a Private Endpoint and test resolution inside the Jump VM.</p>
<div class="highlight"><pre><span></span><code><span class="nv">$peName</span> <span class="p">=</span> <span class="s2">&quot;&lt;private-endpoint-name&gt;&quot;</span>
<span class="n">az</span> <span class="n">network</span> <span class="n">private-endpoint</span> <span class="n">dns-zone-group</span> <span class="n">list</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="nv">$workloadRg</span> <span class="p">-</span><span class="n">-endpoint-name</span> <span class="nv">$peName</span> <span class="p">-</span><span class="n">-query</span> <span class="s2">&quot;[].privateDnsZoneConfigs[].recordSets[].fqdn&quot;</span> <span class="n">-o</span> <span class="n">tsv</span>
</code></pre></div>
<p><strong>Cleanup</strong></p>
<p>Delete the workload resource group.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="nb">group </span><span class="n">delete</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$workloadRg</span> <span class="p">-</span><span class="n">-yes</span> <span class="p">-</span><span class="n">-no-wait</span>
</code></pre></div>
<p>If the VNet was created only for this walkthrough, delete the networking resource group.</p>
<div class="highlight"><pre><span></span><code><span class="n">az</span> <span class="nb">group </span><span class="n">delete</span> <span class="p">-</span><span class="n">-name</span> <span class="nv">$netRg</span> <span class="p">-</span><span class="n">-yes</span> <span class="p">-</span><span class="n">-no-wait</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <div style="
  background-color: var(--md-primary-fg-color);
  color: var(--md-primary-bg-color);
  text-align: center;
  font-size: 0.95em;
  padding: 1em 0;
">
  Â© 2026 Azure AI Landing Zones
</div>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.icon", "content.iconify", "navigation.tracking", "toc.integrate", "content.code.annotate", "navigation.top"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>